<div class="location-form-container">
  <div class="header">
    <h2>{{ isEditMode ? 'Editar' : 'Novo' }} Local de Estoque</h2>
  </div>

  <!-- Error Message -->
  <div class="error-banner" *ngIf="errorMessage">
    <mat-icon class="error-icon">warning</mat-icon>
    <p>{{ errorMessage }}</p>
  </div>

  <form [formGroup]="locationForm" (ngSubmit)="onSubmit()">
    <!-- Basic Information -->
    <div class="form-section">
      <h3>Informações Básicas</h3>

      <div class="form-row">
        <!-- Name -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nome <span class="required">*</span></mat-label>
          <input
            matInput
            formControlName="name"
            required
            aria-label="Nome do local de estoque"
            aria-required="true"
            [attr.aria-describedby]="isFieldInvalid('name') ? 'name-error' : null">
          <mat-error id="name-error" role="alert" *ngIf="locationForm.get('name')?.hasError('required')">
            Campo obrigatório
          </mat-error>
          <mat-error id="name-error" role="alert" *ngIf="locationForm.get('name')?.hasError('maxlength')">
            Máximo de 100 caracteres
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <!-- Code -->
        <mat-form-field appearance="outline">
          <mat-label>Código <span class="required">*</span></mat-label>
          <input
            matInput
            formControlName="code"
            placeholder="Ex: LOJA-SP-01"
            [readonly]="isEditMode"
            required
            aria-label="Código do local"
            aria-required="true"
            [attr.aria-describedby]="isEditMode ? 'code-hint' : (isFieldInvalid('code') ? 'code-error' : null)">
          <mat-hint id="code-hint">Use apenas letras maiúsculas, números e hífens. Não pode ser alterado após criação.</mat-hint>
          <mat-error id="code-error" role="alert" *ngIf="locationForm.get('code')?.hasError('required')">
            Código é obrigatório
          </mat-error>
          <mat-error id="code-error" role="alert" *ngIf="locationForm.get('code')?.hasError('maxlength')">
            Máximo de 20 caracteres
          </mat-error>
          <mat-error id="code-error" role="alert" *ngIf="locationForm.get('code')?.hasError('pattern')">
            Use apenas letras maiúsculas, números e hífens
          </mat-error>
        </mat-form-field>

        <!-- Type -->
        <mat-form-field appearance="outline">
          <mat-label>Tipo <span class="required">*</span></mat-label>
          <mat-select
            formControlName="type"
            required
            aria-label="Tipo de local de estoque"
            aria-required="true"
            [attr.aria-describedby]="isFieldInvalid('type') ? 'type-error' : null">
            <mat-option *ngFor="let type of locationTypes" [value]="type">
              {{ locationTypeLabels[type] }}
            </mat-option>
          </mat-select>
          <mat-error id="type-error" role="alert" *ngIf="locationForm.get('type')?.hasError('required')">
            Tipo é obrigatório
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <!-- Description -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Descrição</mat-label>
          <textarea
            matInput
            formControlName="description"
            rows="3"
            aria-label="Descrição do local"></textarea>
        </mat-form-field>
      </div>
    </div>

    <!-- Address -->
    <div class="form-section">
      <h3>Endereço</h3>

      <div class="form-row">
        <!-- Address -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Endereço</mat-label>
          <input
            matInput
            formControlName="address"
            aria-label="Endereço do local">
        </mat-form-field>
      </div>

      <div class="form-row">
        <!-- City -->
        <mat-form-field appearance="outline">
          <mat-label>Cidade</mat-label>
          <input
            matInput
            formControlName="city"
            aria-label="Cidade">
        </mat-form-field>

        <!-- State -->
        <mat-form-field appearance="outline">
          <mat-label>Estado</mat-label>
          <input
            matInput
            formControlName="state"
            maxlength="2"
            placeholder="Ex: SP"
            aria-label="Estado">
        </mat-form-field>

        <!-- Postal Code -->
        <mat-form-field appearance="outline">
          <mat-label>CEP</mat-label>
          <input
            matInput
            formControlName="postalCode"
            aria-label="CEP">
        </mat-form-field>
      </div>

      <div class="form-row">
        <!-- Country -->
        <mat-form-field appearance="outline">
          <mat-label>País</mat-label>
          <input
            matInput
            formControlName="country"
            aria-label="País">
        </mat-form-field>
      </div>
    </div>

    <!-- Contact -->
    <div class="form-section">
      <h3>Contato</h3>

      <div class="form-row">
        <!-- Phone -->
        <mat-form-field appearance="outline">
          <mat-label>Telefone</mat-label>
          <input
            matInput
            type="tel"
            formControlName="phone"
            aria-label="Telefone do local">
        </mat-form-field>

        <!-- Email -->
        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <input
            matInput
            type="email"
            formControlName="email"
            aria-label="Email do local"
            [attr.aria-describedby]="isFieldInvalid('email') ? 'email-error' : null">
          <mat-error id="email-error" role="alert" *ngIf="locationForm.get('email')?.hasError('email')">
            Email inválido
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <!-- Actions -->
    <div class="form-actions">
      <button
        mat-stroked-button
        type="button"
        (click)="cancel()"
        [disabled]="isSubmitting"
        aria-label="Cancelar e voltar para lista de locais">
        Cancelar
      </button>
      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="isSubmitting || locationForm.invalid"
        [attr.aria-label]="isSubmitting ? 'Salvando local...' : (isEditMode ? 'Salvar alterações do local' : 'Criar novo local')">
        <mat-icon *ngIf="!isSubmitting">save</mat-icon>
        {{ isSubmitting ? 'Salvando...' : 'Salvar' }}
      </button>
    </div>
  </form>
</div>
