<div class="container-fluid py-4">
  <div class="row">
    <div class="col-md-8 offset-md-2">
      <h2>{{ isEditMode ? 'Editar' : 'Novo' }} Local de Estoque</h2>

      <!-- Error Alert -->
      <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>Erro:</strong> {{ errorMessage }}
        <button type="button" class="btn-close" (click)="errorMessage = null"></button>
      </div>

      <!-- Form -->
      <form [formGroup]="locationForm" (ngSubmit)="onSubmit()" class="mt-4">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">Informações Básicas</h5>
          </div>
          <div class="card-body">
            <!-- Name -->
            <div class="mb-3">
              <label for="name" class="form-label">Nome *</label>
              <input
                type="text"
                class="form-control"
                id="name"
                formControlName="name"
                [class.is-invalid]="isFieldInvalid('name')"
              >
              <div *ngIf="isFieldInvalid('name')" class="invalid-feedback">
                {{ getFieldError('name') }}
              </div>
            </div>

            <!-- Code -->
            <div class="mb-3">
              <label for="code" class="form-label">Código *</label>
              <input
                type="text"
                class="form-control"
                id="code"
                formControlName="code"
                placeholder="Ex: LOJA-SP-01"
                [class.is-invalid]="isFieldInvalid('code')"
                [readonly]="isEditMode"
              >
              <small class="form-text text-muted">
                Use apenas letras maiúsculas, números e hífens. Não pode ser alterado após criação.
              </small>
              <div *ngIf="isFieldInvalid('code')" class="invalid-feedback">
                {{ getFieldError('code') }}
              </div>
            </div>

            <!-- Type -->
            <div class="mb-3">
              <label for="type" class="form-label">Tipo *</label>
              <select
                class="form-control"
                id="type"
                formControlName="type"
                [class.is-invalid]="isFieldInvalid('type')"
              >
                <option *ngFor="let type of locationTypes" [value]="type">
                  {{ locationTypeLabels[type] }}
                </option>
              </select>
              <div *ngIf="isFieldInvalid('type')" class="invalid-feedback">
                {{ getFieldError('type') }}
              </div>
            </div>

            <!-- Description -->
            <div class="mb-3">
              <label for="description" class="form-label">Descrição</label>
              <textarea
                class="form-control"
                id="description"
                formControlName="description"
                rows="3"
              ></textarea>
            </div>
          </div>
        </div>

        <!-- Address Card -->
        <div class="card mt-3">
          <div class="card-header">
            <h5 class="mb-0">Endereço</h5>
          </div>
          <div class="card-body">
            <!-- Address -->
            <div class="mb-3">
              <label for="address" class="form-label">Endereço</label>
              <input
                type="text"
                class="form-control"
                id="address"
                formControlName="address"
              >
            </div>

            <div class="row">
              <!-- City -->
              <div class="col-md-4 mb-3">
                <label for="city" class="form-label">Cidade</label>
                <input
                  type="text"
                  class="form-control"
                  id="city"
                  formControlName="city"
                >
              </div>

              <!-- State -->
              <div class="col-md-4 mb-3">
                <label for="state" class="form-label">Estado</label>
                <input
                  type="text"
                  class="form-control"
                  id="state"
                  formControlName="state"
                  maxlength="2"
                  placeholder="Ex: SP"
                >
              </div>

              <!-- Postal Code -->
              <div class="col-md-4 mb-3">
                <label for="postalCode" class="form-label">CEP</label>
                <input
                  type="text"
                  class="form-control"
                  id="postalCode"
                  formControlName="postalCode"
                >
              </div>
            </div>

            <!-- Country -->
            <div class="mb-3">
              <label for="country" class="form-label">País</label>
              <input
                type="text"
                class="form-control"
                id="country"
                formControlName="country"
              >
            </div>
          </div>
        </div>

        <!-- Contact Card -->
        <div class="card mt-3">
          <div class="card-header">
            <h5 class="mb-0">Contato</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <!-- Phone -->
              <div class="col-md-6 mb-3">
                <label for="phone" class="form-label">Telefone</label>
                <input
                  type="tel"
                  class="form-control"
                  id="phone"
                  formControlName="phone"
                >
              </div>

              <!-- Email -->
              <div class="col-md-6 mb-3">
                <label for="email" class="form-label">Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  formControlName="email"
                  [class.is-invalid]="isFieldInvalid('email')"
                >
                <div *ngIf="isFieldInvalid('email')" class="invalid-feedback">
                  {{ getFieldError('email') }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="mt-4 d-flex gap-2">
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="isSubmitting"
          >
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
            {{ isSubmitting ? 'Salvando...' : 'Salvar' }}
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            (click)="cancel()"
            [disabled]="isSubmitting"
          >
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
